<h1>All Products</h1>

<div class="search-section">
    <%= form_with url: root_path, method: :get, local: true do |f| %>
      <div class="search-row">
        <div class="search-field">
          <%= f.label :search, "Search Products:" %>
          <%= f.text_field :search, value: @search_query, placeholder: "Enter keywords..." %>
        </div>
        
        <div class="search-field">
          <%= f.label :category_id, "Filter by Category:" %>
          <%= f.select :category_id, 
              options_from_collection_for_select(@categories, :id, :name, @selected_category),
              { prompt: "All Categories" },
              { class: "category-select" } %>
        </div>
        
        <div class="search-actions">
          <%= f.submit "Search", class: "btn btn-primary" %>
          <%= link_to "Clear", root_path, class: "btn btn-secondary" %>
        </div>
      </div>
    <% end %>
  </div>

  <% if @search_query.present? || @selected_category.present? %>
    <div>
      <p>
        Found <%= @products.count %> product<%= 's' unless @products.count == 1 %>
        <% if @search_query.present? %>
          matching "<%= @search_query %>"
        <% end %>
        <% if @selected_category.present? %>
          in <%= Category.find(@selected_category).name %>
        <% end %>
      </p>
    </div>
  <% end %>

<div class="products">
  <% @products.each do |product| %>
    <div class="product-card">
      <h3><%= link_to product.name, product_path(product) %></h3>
      <p><%= number_to_currency(product.price) %></p>
      <p>Stock: <%= product.stock_quantity %></p>
      <p>Categories: <%= product.categories.map(&:name).join(", ") %></p>
      
      <% if user_signed_in? %>
        <%= button_to "Add to Cart", add_to_cart_path(product), method: :post %>
      <% end %>
    </div>
  <% end %>
</div>